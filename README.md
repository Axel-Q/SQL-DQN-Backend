# SQL-DQN-Backend

## Description

This is a simple game/ framework for demonstration purpose that I designed for CS7675. SQL-DQN is an interactive educational game that combines SQL learning with reinforcement learning and LLM in a electable themed environment.
This game adapts SQL puzzle level based on player's mastery using a Deep Q-Network (DQN) reinforcement learning agent, and embeds every challenge in engaging narratives generated by LLM.

## Key Features
- **Adaptive Learning**: DQN agent selects appropriate puzzles based on player performance, namely, mastery of SQL concepts.
- **Interactive SQL Challenges**: Players write SQL queries against a thematic database.
- **Diverse Concepts**: Tasks range from basic SELECT statements to complex joins.
- **Narrative Experience**: Narrative elements are personalized, each player will unfold a unique storyline as they process SQL concepts.
- **Extensible Framework**: Support for custom themes, storylines, and database schemas.

## Technologies
- **Backend**: TypeScript, Node.js, Express
- **Database**: PostgreSQL
- **Machine Learning**: TensorFlow.js for DQN implementation
- **LLM**: DeepSeek API for generating narratives
- **API**: RESTful endpoints for game state management

## Usage
1. Clone the repository.
2. Install the dependencies using `npm install`.
3. Run the server using `npx tsx src/index.ts`.

## Project Structure
```bash
sql-dqn/
├── package.json              # Project dependencies and scripts
├── tsconfig.json             # TypeScript configuration
├── .env                      # Environment variables (DB credentials)
├── .gitignore                # Git ignored files
│
├── src/                      # Source code
│   ├── index.ts              # Application entry point
│   │
│   ├── agent/                # Reinforcement learning components
│   │   ├── DQNAgent.ts       # Deep Q-Network agent implementation
│   │   ├── QNetwork.ts       # Neural network model for Q-learning
│   │   └── ReplayBuffer.ts   # Experience replay memory
│   │
│   ├── environment/          # Game environment
│   │   └── MatrixSQLEnvironment.ts  # Environment for SQL game interactions
│   │
│   ├── resources/            # Data and query resources
│   │   ├── easy_queries.ts   # SQL challenges with narratives
│   │   ├── data_generator.py # Python script to generate training data
│   │   └── generated_data.csv # Pre-generated training data
│   │
│   ├── server/               # Backend server code
│   │   ├── server.ts         # Express server setup
│   │   ├── controllers/      # Request handlers
│   │   │   ├── setup.controller.ts  # Initialize game/agent
│   │   │   └── query.controller.ts  # Process SQL queries
│   │   ├── middleware/       # Express middleware
│   │   │   └── error.middleware.ts  # Error handling
│   │   └── routes/           # API routes
│   │       └── api.routes.ts # Route definitions
│   │
│   ├── types/                # Type definitions
│   │   └── index.ts          # Shared TypeScript interfaces
│   │
│   └── utils/                # Utility functions
│       ├── database.utils.ts # Database connection helpers
│       └── training.utils.ts # Training data processing utilities
│
├── public/                   # Frontend static files
│   ├── index.html            # Main HTML page with UI structure
│   ├── script.js             # Frontend JavaScript (event handlers, API calls)
│   └── styles.css            # CSS styles for the game interface
│
└── README.md                 # Project documentation
```

## To-Do
- [ ] Check why the DQN agent will choose the same action once when the mastery is equal to 1.
- [ ] Write tests, fix bugs and check for edge cases.

## Schema
### Cyberpunk
- `residue`
    | column_name | data_type    |
    | ----------- | ------------ |
    | name        | VARCHAR (50) |
    | status      | VARCHAR (50) |

    | name     | status              |
    | -------- | ------------------- |
    | Neo      | PotentialRebel      |
    | Trinity  | PotentialRebel      |
    | Morpheus | Captain             |
    | Jane Doe | null                |
    | Smith    | EliminationProtocol |
    
- `archives`
    | column_name         | data_type    |
    | ------------------- | ------------ |
    | mission_id          | INT          |
    | mission_name        | VARCHAR (50) |
    | mission_description | TEXT         |

    | mission_id | mission_name         | mission_description                              |
    | ---------- | -------------------- | ------------------------------------------------ |
    | 1          | Free The Mind        | An attempt to awaken humanity.                   |
    | 2          | Locate The Key-maker | Securing the Keymaker for the Source.            |
    | 3          | Defend Zion          | Protect the last human city from Sentinels.      |
    | 4          | Rescue Operator      | An operator has gone missing in the field.       |
    | 5          | Eliminate Virus      | Suspected virus detected within the Matrix code. |

- `mission_logs`
    | column_name  | data_type   |
    | ------------ | ----------- |
    | mission_name | VARCHAR(50) |
    | agent_id     | INT         |
    | reference    | TEXT        |

    | mission_name    | agent_id | reference                                     |
    | --------------- | -------- | --------------------------------------------- |
    | Free The Mind   | 101      | Operation started, Morpheus leads             |
    | Free The Mind   | 101      | Strange glitch observed in downtown           |
    | Defend Zion     | 103      | Sentinel swarm approaching main gate          |
    | Eliminate Virus | 102      | Agent Smith anomaly flagged for investigation |
    
- `multi_agent_events`
    | column_name       | data_type   |
    | ----------------- | ----------- |
    | agent_id          | INT         |
    | timestamp         | TIMESTAMP   |
    | location          | VARCHAR(50) |
    | agent_replication | BOOLEAN     |
    
    | agent_id | timestamp           | location      | agent_replication |
    | -------- | -------- | ------------------- | --------------- |
    | 101      | 2023-01-01 09:15:00 | Downtown      | FALSE             |
    | 101      | 2023-01-01 09:30:00 | Downtown      | FALSE             |
    | 102      | 2023-01-01 10:00:00 | Rooftop       | TRUE              |
    | 102      | 2023-01-01 10:15:00 | SubwayStation | TRUE              |
    | 103      | 2023-01-01 10:30:00 | NULL          | FALSE             |
